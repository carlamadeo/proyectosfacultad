external string UseCases;

#include "qrl/tsdl_extract.inc"
#include "qrl/basic_textract_dt.inc"
#include "qrl/include/error.inc"

#include "val/qrl/include/TConfig.inc"
#include "val/qrl/include/TUseCase.inc"

#include "val/qrl/include/ExtractOneModel.inc"
#include "val/qrl/include/Progress.inc"
#include "val/qrl/include/tdrvMessaging.inc"
#include "val/qrl/include/CreateDir.inc"

void 
main ()
{
  initProgress(20);
  initValidatorOperationMessage("Extract Model", UseCases);

  string sOutputPath = current_projdir() + current_system() + "/test_files/";
  string path;

  list UseCaseList;
  int count, i;
  string use_case_name, test_unit_id;

  UseCaseList = string_to_list (UseCases, " ");
  count = list_count (UseCaseList);
  
  setProgressStep(calcProgressStep(20, 90, count));
  updateProgress("Extracting models...");
  for (i=0;i<count;i++)
    {
      use_case_name = list_get(UseCaseList,i);
      if (!CheckExistance (use_case_name) )
        {
          validatorErrorMessage("Use Case: " + use_case_name + " is not in the selected model");
          continue;
        }

      test_unit_id = Get_T_test_unit_id(use_case_name, "");
      extractOneModel(test_unit_id); // located in ExtractOneModel.inc
      updateProgress("");
    }

  progress("Writing buffers...", 100);
  finalizeValidatorOperationMessage("Extract Model");

  doneProgress();
}


