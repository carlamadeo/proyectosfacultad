//      StP/UML
//      Confidential property of Aonix
//      Copyright (c) 1997
//      All rights reserved


NodeSymbol 10 Actor     // shared definition
{}
Include "rules/actor_sym.rules.common"
Include "rules/usequenced.prop"

DiagramType
{
        { SyntaxCheckFunc usequenced_CheckSyntax }
}

NodeSymbol Actor
{
    { Shape
        { Predefined Bar }
        { ToolbarImage "actor_sequence" }
    }
    { LabelAnchor North }
    { DefaultSize 1.0 10}
    { DisplayMark
        { Name UnderlineEffect }
        { LabelMark Underscore }
        { Help "Underline Actor label" }
    }
    // Begin Add ECR4221
    // Show a small Actor Symbol 
    { DisplayMark
        { Name MiniActor }
        // ECR 5175 begin
        // { Anchor UpperCenter }
        { Anchor UpperRight }
        // ECR 5175 end
        { BitmapMark0 "actor0" }
        { BitmapMark1 "actor1" }
        { BitmapMark2 "actor2" }
        // ECR 5175 begin
        // { HAdjust Center }
        // { XPixelOffset  -10 }
        { HAdjust Left }
        { XPixelOffset  3 }
        // ECR 5175 end
        { VAdjust Top }
        { YPixelOffset  5 }
    }
    // End Add ECR4221
    { DisplayMark
        { Name ActorStereotype }
        //{ StringMark "«Actor»" }
        //{ CondFunc "AlwaysTrue();" }
        { ItemCond (UmlStereotype) }
    // Changed to False for ECR4221
        { CallUncond False }
        { StringMarkFunc "uml_label_mark_func_get_default(gde_dmark_matched_items,\"Actor\");" }
        { Anchor LabelUpperCenter }
        { HAdjust Center }
        { VAdjust Bottom }
        { Help "Constant <<Actor>> String" }
    }
    { HAdjust Center }
    { VAdjust Bottom }
//     { NameCompletion
//         { NameCompletionFunc actor_name_completion_func }
//     }
}

NodeSymbol 20 Note // shared definition - see also vertex
{}

// ECR947, ECR 4494
// Added CommentAnchor
CntxSymbol CommentAnchor
{
    { ParentLink AllLinkSymbols }
}
// End ECR947, ECR 4494

NodeSymbol 30 Package // Package symbol is shared
{}
NodeSymbol 31 PackageName
{
    //{ Cardinality { Min 1 } { Max 1 } { InLinks PackageComponentLink } }
    { Cardinality { Min 1 } { Max 1 } { InLinks Contains } }
}
Include "rules/package_sym.rules.common"
// add to the shared definition
NodeSymbol Package
{
    { AutoScaleLarger True }
    { AutoScaleSmaller False }
    { CanApplyScaleCmd True }

    { DefaultSize 2.1 1.4 }
    { ReplaceSet ( PackageName ) }
}


TypeSet Object
{
    PassiveObject
    ActiveObject
}
NodeSymbol 40 PassiveObject
{}
NodeSymbol 41 ActiveObject
{}
Include "rules/object_sym.rules.common"
TypeSet ObjectSet // used for navigations
{
    Object
}

NodeSymbol Object
{
    { LabelAnchor North }
    { HAdjust Center }
    { VAdjust Bottom } 
    { CanAdjustLabel False }
//ECR 6231 - Moved next line to PassiveObject and ActiveObject node symbols definition
//    { DefaultSize 1.0 10}
    { DisplayMark
        { Name UnderlineEffect }
        { LabelMark Underscore }
        //{ XPixelOffset 5 }
        { YPixelOffset 0 }
        { Help "Underline Object label" }
    }
    { DisplayMark
        { Name BoxEffect }
        { LabelMark Box }
        { XPixelOffset 5 }
        { YPixelOffset 6 }
        { Help "Object label box" }
    }
    { Components
        { ScaleWidth Larger }
        //{ ScaleHeight Fit }   
        { LineAbove True }
        //{ LineBelow False }
    }
    { ReadOnly False }
}

NodeSymbol PassiveObject
{
    { Shape
        { Predefined Lifeline }
        { ToolbarImage "passive_object" }
    }
    { DefaultSize 1.0 10}       //ECR 6231
    { PrintName "Passive Object" }
    { PreserveScale PassiveObject }
    { PreserveScale ActiveObject }
    { ReplaceSet (ActiveObject) }
    { AutoScaleLarger False }
    { AutoScaleSmaller False }
}


NodeSymbol ActiveObject
{
    { Shape
        { Predefined ActiveLifeline } 
        { ToolbarImage "object_sequence" }
    }
    { DefaultSize 1.0 10}       //ECR 6231
    { PrintName "Active Object" }
    { PreserveScale PassiveObject }
    { PreserveScale ActiveObject }
    { ReplaceSet (PassiveObject) }
    { AutoScaleLarger False }
    { AutoScaleSmaller False }
    { NodeMapping
        { MappingName ActiveObjectMapping }
        { AppType UmlActiveObject }
        { NameFunc uml_qualified_object_name } 
        { NameIsRequired True }
        { Scope
            { Symbol Self }
            { MappingName ObjectScope }
        }
        { InverseMapFunc object_instance_label } //uml_object_inverse_node_map_func
    }
}

NodeSymbol 50 ScenarioInstance
{
}

TypeSet ScenarioInstanceSet
{
    ScenarioInstance
}

Include "rules/scenario_sym.rules.common"
  

NodeSymbol 60 ExtensionPoint
{}
Include "rules/extension_sym.rules.common"

// SPR 4052 - Model Management
// used for Model Management to have one common display mark
TypeSet AllLockableNodeTypes
{
    ScenarioInstance
    Package
    PassiveObject
    ActiveObject
    Actor
}

TypeSet AllLinkSymbols
{
    Contains
    SimpleMessage
    SynchronousMessage
    BalkingMessage
    TimeoutMessage
    AsynchronousMessage
    ReturnMessage 
    NoteLink // ECR 4496
}

NodeSymbol 70 Vertex // shared symbol
{
    { ReplaceSet ( None ) }
    { Cardinality { Min 1 } { Max 1 } { InLinks AllLinkSymbols } }
    { Cardinality { Min 1 } { Max 1 } { OutLinks AllLinkSymbols } }
}
Include "rules/note_vertex_syms.rules.common"

TypeSet AllNoteableNodeTypes
{
    Actor
    Package
    Object
    ExtensionPoint
    Vertex
// ECR947, ECR 4494
    CommentAnchor
    TimeSent
    TimeDelivered
    Constraint
// End ECR947, ECR 4494
}

// Containment

LinkSymbol 100 Contains
{
    { Connects { From Package } { To Package } }
    { Connects { From Package } { To Object } }
    { LinkMapping
        { MappingName ComponentMapping }
        { AppType UmlContains }
        { FromNode
            { Symbol FromNode }
            { MappingName ClassMapping } }
        { ToNode
            { Symbol ToNode }
            { MappingName ClassMapping } } 
    }
    { Uncentered True }
    { CanBeVisible False }
    { CanBeInclude True }
}


LinkSymbol 120 SimpleMessage
{
    { PrintName "Simple Message" }
    { LinkMapping
        { MappingName MessageInstanceMapping }
        { InverseMapFunc uml_message_inverse_mapping }
        //{ PreconditionFunc booch_object_link_maps_forward }
        { AppType UmlSimpleMessage }
        { NameFunc      uml_gde_link_name_func }
        //{ SigFunc     booch_message_sig }
        { FromNode
            { Symbol FromNode }
            { MappingName ObjectMapping }
        }
        { ToNode
            { Symbol ToNode }
            { MappingName ObjectMapping }
        }
        //{ Scope
        //{ MappingName ObjectDiagScopeMapping }
        //{ SymbolFunc uml_instance_owner_scope }
        //}
        //{ NameIsRequired True }
    }
    { ToOpenArrow True } // ECR 4858
}

LinkSymbol 130 SynchronousMessage
{
    { PrintName "Synchronous Message" }
    { LinkMapping
        { MappingName MessageInstanceMapping }
        { InverseMapFunc uml_message_inverse_mapping }
        //{ PreconditionFunc booch_object_link_maps_forward }
        { AppType UmlSynchronousMessage }
        { NameFunc      uml_gde_link_name_func }
        //{ SigFunc     booch_message_sig }
        { FromNode
            { Symbol FromNode }
            { MappingName ObjectMapping }
        }
        { ToNode
            { Symbol ToNode }
            { MappingName ObjectMapping }
        }
    }
    { ToFilledArrow True }  // ECR 4858
//    { DisplayMark
//        { Name SynchMark }
//        { Anchor ToEnd }
//        { BitmapMark0 "sync0" }
//        { BitmapMark1 "sync1" }
//        { BitmapMark2 "sync2" }
//        { HAdjust Center }
//        { VAdjust Center }
//        { XPixelOffset  25 }
//        { YPixelOffset  0 }
//    }
}

LinkSymbol 140 BalkingMessage
{
    { PrintName "Balking Message" }
    { LinkMapping
        { MappingName MessageInstanceMapping }
        { InverseMapFunc uml_message_inverse_mapping }
        //{ PreconditionFunc booch_object_link_maps_forward }
        { AppType UmlBalkingMessage }
        { NameFunc      uml_gde_link_name_func }
        //{ SigFunc     booch_message_sig }
        { FromNode
            { Symbol FromNode }
            { MappingName ObjectMapping }
        }
        { ToNode
            { Symbol ToNode }
            { MappingName ObjectMapping }
        }
    }
    { ToFilledArrow True } // ECR 4858
    { DisplayMark
        { Name BalkMark }
        { Anchor ToEnd }
        { BitmapMark0 "balk0" }
        { BitmapMark1 "balk1" }
        { BitmapMark2 "balk2" }
        { HAdjust Center }
        { VAdjust Center }
        { XPixelOffset  12 }
        { YPixelOffset  12 }
    }
}

LinkSymbol 150 TimeoutMessage
{
    { PrintName "Timeout Message" }
    { LinkMapping
        { MappingName MessageInstanceMapping }
        { InverseMapFunc uml_message_inverse_mapping }
        //{ PreconditionFunc booch_object_link_maps_forward }
        { AppType UmlTimeoutMessage }
        { NameFunc      uml_gde_link_name_func }
        //{ SigFunc     booch_message_sig }
        { FromNode
            { Symbol FromNode }
            { MappingName ObjectMapping }
        }
        { ToNode
            { Symbol ToNode }
            { MappingName ObjectMapping }
        }
    }
    { ToFilledArrow True } // ECR 4858
    { DisplayMark
        { Name TimeMark }
        { Anchor ToEnd }
        { BitmapMark0 "time0" }
        { BitmapMark1 "time1" }
        { BitmapMark2 "time2" }
        { HAdjust Center }
        { VAdjust Center }
        { XPixelOffset  12 }
        { YPixelOffset  12 }
    }
}

LinkSymbol 160 AsynchronousMessage
{
    { PrintName "Asynchronous Message" }
    { LinkMapping
        { MappingName MessageInstanceMapping }
        { InverseMapFunc uml_message_inverse_mapping }
        //{ PreconditionFunc booch_object_link_maps_forward }
        { AppType UmlAsynchronousMessage }
        { NameFunc      uml_gde_link_name_func }
        //{ SigFunc     booch_message_sig }
        { FromNode
            { Symbol FromNode }
            { MappingName ObjectMapping }
        }
        { ToNode
            { Symbol ToNode }
            { MappingName ObjectMapping }
        }
    }
    // ECR 4858
    { ToHalfArrow True }
//    { DisplayMark
//        { Name AsynMark }
//        { Anchor ToEnd }
//        { BitmapMark0 "asyn0" }
//        { BitmapMark1 "asyn1" }
//        { BitmapMark2 "asyn2" }
//        { HAdjust Center }
//        { VAdjust Center }
//        { XPixelOffset  12 }
//        { YPixelOffset  12 }
//    }
}
LinkSymbol 170 ReturnMessage
{
    { PrintName "Return Message" }
    { LinkMapping
        { MappingName MessageInstanceMapping }
        { InverseMapFunc uml_message_inverse_mapping }
        //{ PreconditionFunc booch_object_link_maps_forward }
        { AppType UmlReturnMessage }
        { NameFunc      uml_gde_link_name_func }
        //{ SigFunc     booch_message_sig }
        { FromNode
            { Symbol FromNode }
            { MappingName ObjectMapping }
        }
        { ToNode
            { Symbol ToNode }
            { MappingName ObjectMapping }
        }
        //{ Scope
        //{ MappingName ObjectDiagScopeMapping }
        //{ SymbolFunc uml_instance_owner_scope }
        //}
        //{ NameIsRequired True }
    }
    { ToOpenArrow True } // ECR 4858
    { Dashed True }
}

TypeSet ActivationMessageSymbols
{
    SimpleMessage
    SynchronousMessage
    BalkingMessage
    TimeoutMessage
    AsynchronousMessage
    ReturnMessage
}
TypeSet DeactivationMessageSymbols
{
    ReturnMessage
}

TypeSet OperationMessageSymbols
{
    SimpleMessage
    SynchronousMessage
    BalkingMessage
    TimeoutMessage
    ReturnMessage
}

TypeSet SignalMessageSymbols
{
    AsynchronousMessage
}
    
TypeSet MessageSymbols
{
    ActivationMessageSymbols
    DeactivationMessageSymbols
}

LinkSymbol ActivationMessageSymbols
{
    { ApplicationTag "LifelineActivation" }
}
LinkSymbol DeactivationMessageSymbols
{
    { ApplicationTag "LifelineDeactivation" }
}

LinkSymbol MessageSymbols
{
}

Include "rules/scenario_message_syms.rules.common"

LinkSymbol SimpleMessage
{
    // make this a default link
    { Connects { From Object } { To Object } { IsDefault True } }
    { Connects { From Actor } { To Object } { IsDefault True } }
    { Connects { From Object } { To Actor } { IsDefault True } }
}

CntxSymbol 210 TimeSent
{
    { PrintName "Start Time" }// Event
    { Shape
        { Predefined BachLabel }
        { ToolbarImage "start_time" }
    }
    { LabelAnchor East }
    { CntxMapping 
        { AppType UmlTimeSent }
        { Parent
            { MappingName MessageInstanceMapping }
        }
    }
}

CntxSymbol 220 TimeDelivered
{
    { PrintName "End Time" }// Event
    { Shape
        { Predefined BachLabel }
        { ToolbarImage "end_time" }
    }
    { LabelAnchor West }
    { CntxMapping 
        { AppType UmlTimeDelivered }
        { Parent
            { MappingName MessageInstanceMapping }
        }
    }
}


TypeSet TransitionNameTypes
{
    TimeSent
    TimeDelivered
}

CntxSymbol TransitionNameTypes
{
    { ReadOnly True }
    { AutoScaleLarger True }
    { AutoScaleSmaller True }
    { ShowTypeLabel True }
    { CanApplyScaleCmd False }
    { CanAdjustLabel False }
    { CanHaveLabel True }
    { DefaultSize 1.0 0.3 }
    { ParentLink MessageSymbols }
    { Align False }
    { ReplaceSet ( None ) }
    { ReparentOnMove False }
}

CntxSymbol 230 Constraint
{
    { PrintName "Constraint" }
    { CntxMapping 
        { AppType UmlConstraint }
        { Parent
            { MappingName MessageInstanceMapping }
        }
    }
    { DisplayMark
        { Name ConstraintBefore }
        { LabelMark LeftBar }
        { StringMark "{ " }
        { HAdjust Right }
        { VAdjust Center }
        { Anchor LabelCenterLeft }
        { Help "Constant left brace for constraint" }
    }
    { DisplayMark
        { Name ConstraintAfter }
        { LabelMark RightBar }
        { StringMark " }" }
        { HAdjust Left }
        { VAdjust Center }
        { Anchor LabelCenterRight }
        { Help "Constant right brace for constraint" }
    }
    { ReadOnly True }
    { Shape
        { Predefined BachLabel }
        { ToolbarImage "constraint" }
    }
    { AutoScaleLarger True }
    { AutoScaleSmaller True }
    { ShowTypeLabel True }
    { CanApplyScaleCmd False }
    { CanAdjustLabel False }
    { CanHaveLabel True }
    { DefaultSize 1.0 0.3 }
    { ParentLink MessageSymbols }
    { Align False }
    { ReplaceSet ( None ) }
    { ReparentOnMove True }
}


//TypeSet       AutoScaleNodes
//{
//    Object
//}

//NodeSymbol AutoScaleNodes
//{
//    { AutoScaleSmaller False }
//    { AutoScaleLarger True }
//    { CanApplyScaleCmd True }
//}

// SPR 4052 Model management, different location of stereotype for packages
TypeSet StereotypeableOnPackageNodeSet
{
    Package
    PackageName
}

//TypeSet StereotypeableOnSymbolNodeSet
//{
//    // nodes
//    //Actor
////    Object
//}


TypeSet StereotypeableInLabelNodeSet
{
    Object
}


TypeSet StereotypeableLinkSet 
{
    // links
    MessageSymbols
}
Include "rules/stereotype_dm.rules.common"


DisplayMarkGroups
{
    { Group
        { Name SequenceInfo}
        { DisplayMarks 
              ( UnderlineEffect ActorStereotype BoxEffect 
                ConstraintBefore ConstraintAfter ) }
    }
    { ContinuousDisplayMarks
        (
            Sequences Stereotypes
        )
    }
}

SymbolList
{
    { ShowStraightArc True }
    { ShowSpline True }
    { OrthogonalArcsAreAllowed True }
    { OrthogonalArcsAreDefault False }
    { Symbols
        (
            Note
            SEPARATOR
            Package
            SEPARATOR
            PassiveObject
            ActiveObject
            Actor
            SEPARATOR
            TimeSent
            TimeDelivered
            Constraint
            ExtensionPoint
        )
    }
}



///////////////////////////////////////////////////////

Include "rules/usequenced.gui" // menus and navigations

///////////////////////////////////////////////////////


// Begin Add ECR3785
// TypeSet for all kind of uml node symbols
TypeSet NavigationNodeTypes
{
    Actor
    Package
    Object
    ExtensionPoint
}

// Included navigation targets for all kind of uml node symbols
Include "uml/rules/uml_navigation.rules"
// End Add ECR3785

IncludeIfExists "val/rules/uml/usequenced.rules"

IncludeIfExists "user/uml/rules/user_usequenced.rules"


